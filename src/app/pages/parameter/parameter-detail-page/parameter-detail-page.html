<!-- parameter-detail-page.html -->
<app-page-layout>

  <ng-template appLabel>
    @if (parameter(); as parameters) {
      {{ parameters.name }}
    } @else {
      Новый параметр
    }
  </ng-template>

  <ng-template appButtons></ng-template>

  <ng-template appBody>
    <app-detail-info-layout>
      <form action="" class="form-container" [formGroup]="form">
        <div class="form-content">

          <div class="form-label-container">
            <span class="form-label-container__label">
              Название
            </span>
            <input class="form-label-container__input"
                   type="text"
                   formControlName="name">
            @if (form.get('name')?.invalid && (form.get('name')?.touched)) {
              <div class="form-label-container-error-message">
                @if (form.get('name')?.errors?.['required']) {
                  <span>Название обязательно</span>
                }
                @if (form.get('name')?.errors?.['maxlength']) {
                  <span>Максимальная длина 100 символов</span>
                }
              </div>
            }
          </div>

          <div class="form-label-container">
            <span class="form-label-container__label">
              OID-адрес
            </span>
            <input class="form-label-container__input"
                   type="text"
                   formControlName="address">
            @if (form.get('address')?.invalid && (form.get('address')?.touched)) {
              <div class="form-label-container-error-message">
                @if (form.get('address')?.errors?.['required']) {
                  <span>OID-адрес обязателен</span>
                }
                @if (form.get('address')?.errors?.['maxlength']) {
                  <span>Максимальная длина 100 символов</span>
                }
                @if (form.get('address')?.errors?.['oid']) {
                  <span>Неверный формат OID (пример: 1.3.6.1.2.1.1)</span>
                }
              </div>
            }
          </div>

          <div class="form-label-container">
            <span class="form-label-container__label">
              Тип данных
            </span>
            <app-select
              [options]="dataTypes()"
              [displayField]="'displayName'"
              [valueField]="'name'"
              [placeholder]="'Выберите тип данных'"
              [selectedValue]="form.get('dataType')?.value"
              (valueChange)="onDataTypeChange($event)"
              [class.error]="form.get('dataType')?.invalid && form.get('dataType')?.touched">
            </app-select>
            @if (form.get('dataType')?.invalid && (form.get('dataType')?.touched)) {
              <div class="form-label-container-error-message">
                @if (form.get('dataType')?.errors?.['required']) {
                  <span>Тип данных обязателен</span>
                }
              </div>
            }
          </div>

          @if (isDataTypeEnumerated()) {
            <div class="form-label-container">
              <span class="form-label-container__label">
                Словарь статусов
              </span>
              <app-select
                [options]="statusDictionaryOptions()"
                [displayField]="'name'"
                [valueField]="'id'"
                [placeholder]="'Выберите словарь статусов'"
                [selectedValue]="form.get('statusDictionaryId')?.value"
                [onOptionClick]="handleStatusDictionaryOptionClick"
                (valueChange)="onStatusDictionaryChange($event)"
                [class.error]="form.get('statusDictionaryId')?.invalid && form.get('statusDictionaryId')?.touched">>
              </app-select>
              @if (form.get('statusDictionaryId')?.invalid && (form.get('statusDictionaryId')?.touched)) {
                <div class="form-label-container-error-message">
                  @if (form.get('statusDictionaryId')?.errors?.['required']) {
                    <span>Словарь статусов обязателен</span>
                  }
                </div>
              }
            </div>
          }

          @if (!isDataTypeEnumerated()) {
            <div class="form-label-container">
            <span class="form-label-container__label">
              Метрика
            </span>
              <input class="form-label-container__input"
                     type="text"
                     formControlName="metric">
              @if (form.get('metric')?.invalid && (form.get('metric')?.touched)) {
                <div class="form-label-container-error-message">
                  @if (form.get('metric')?.errors?.['maxlength']) {
                    <span>Максимальная длина 10 символов</span>
                  }
                </div>
              }
            </div>

            <div class="form-label-container">
            <span class="form-label-container__label">
              Константа
            </span>
              <input class="form-label-container__input"
                     type="text"
                     formControlName="additive"
                     (keydown)="onKeyDown($event)">
              @if (form.get('additive')?.invalid && (form.get('additive')?.touched)) {
                <div class="form-label-container-error-message">
                  @if (form.get('additive')?.errors?.['required']) {
                    <span>Константа обязательна</span>
                  }
                </div>
              }
            </div>

            <div class="form-label-container">
            <span class="form-label-container__label">
              Коэффициент
            </span>
              <input class="form-label-container__input"
                     type="text"
                     formControlName="coefficient"
                     (keydown)="onKeyDown($event)">
              @if (form.get('coefficient')?.invalid && (form.get('coefficient')?.touched)) {
                <div class="form-label-container-error-message">
                  @if (form.get('coefficient')?.errors?.['required']) {
                    <span>Коэффициент обязателен</span>
                  }
                  @if (form.get('coefficient')?.errors?.['min']) {
                    <span>Значение не может быть отрицательным</span>
                  }
                </div>
              }
            </div>
          }

          <div class="form-label-container">
            <span class="form-label-container__label">
              Описание
            </span>
            <textarea class="form-label-container__textarea"
                      type="text"
                      formControlName="description">
            </textarea>
            @if (form.get('description')?.invalid && (form.get('description')?.touched)) {
              <div class="form-label-container-error-message">
                @if (form.get('description')?.errors?.['maxlength']) {
                  <span>Максимальная длина 500 символов</span>
                }
              </div>
            }
          </div>

          <div class="form-label-container">
            <span class="form-label-container__label">
              Выбрать устройство
            </span>
            <app-multi-select
              [items]="devices()"
              (selectionChange)="onDevicesSelectionChange($event)">
            </app-multi-select>
          </div>

        </div>

        <div class="buttons-container">
          <app-menu-function-button
            [showDelete]="isEditMode()"
            (onSave)="onSave()"
            (onDelete)="onDelete()"
            (onCancel)="onCancel()">
          </app-menu-function-button>
        </div>
      </form>
    </app-detail-info-layout>
  </ng-template>

</app-page-layout>
